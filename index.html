<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Finance Pro ‚Äî Painel Financeiro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg-main:#020617;
  --bg-surface:#0b1220;
  --bg-card:#0f172a;
  --border:#1e293b;
  --blue:#38bdf8;
  --green:#22c55e;
  --red:#ef4444;
  --yellow:#facc15;
  --text:#e5e7eb;
  --muted:#94a3b8;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, Helvetica, sans-serif;
  font-size: 15px;
  line-height: 1.65;
  letter-spacing: 0.01em;
  background:radial-gradient(1200px 600px at 10% -10%, #0f172a, #020617);
  color:var(--text);
  min-height:100vh;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:280px;
  backdrop-filter:blur(20px);
  background:rgba(2,6,23,.85);
  border-right:1px solid var(--border);
  padding:28px;
  border-radius:0 28px 28px 0;
}
.logo{font-size:24px;font-weight:700;color:var(--blue);margin-bottom:48px}
.menu ul{list-style:none}
.menu li{margin-bottom:12px}
.menu a{
  display:block;
  padding:14px 18px;
  border-radius:18px;
  color:var(--muted);
  text-decoration:none;
  cursor:pointer;
  transition:.2s ease;
  font-size:15px;
  line-height:1.4;
}
.menu li.active a,
.menu a:hover{
  background:rgba(56,189,248,.18);
  color:var(--blue);
}

/* LAYOUT */
.content{flex:1;padding:36px 40px}
.header{
  font-size:32px;
  font-weight:700;
  margin-bottom:28px;
  letter-spacing: 0.02em;
}

/* CARDS */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:20px;margin-bottom:28px;
}
.card{
  backdrop-filter:blur(16px);
  background:rgba(15,23,42,.7);
  border:1px solid var(--border);
  border-radius:26px;
  padding:26px 28px;
  box-shadow:0 8px 30px rgba(0,0,0,.35);
}
.card span{
  color:var(--muted);
  font-size:14px;
  letter-spacing:.4px;
  line-height:1.5;
  margin-bottom:6px;
}
.card h2{
  margin-top:10px;
  font-size:28px;
  line-height:1.2;
}
.blue h2{color:var(--blue)}
.red h2{color:var(--red)}
.green h2{color:var(--green)}
.yellow h2{color:var(--yellow)}

/* CONTROLS */
.controls{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:28px;
  flex-wrap:wrap;
  width:100%;
}
.controls button{
  order: 10;
}
.controls input{
  padding:13px 16px;
  border-radius:18px;
  border:1px solid var(--border);
  background:rgba(15,23,42,.8);
  color:#fff;
  font-size:15px;
}
.controls .valor-input{width:110px}
.controls .data-input{width:120px}
.controls .desc-input{
  flex:1;
  max-width:none;   /* libera a largura total */
  min-width:320px;
}
.controls button{
  padding:12px 16px;
  border-radius:16px;
  border:none;
  background:linear-gradient(135deg,#2563eb,#38bdf8);
  color:#fff;
  font-weight:600;
  cursor:pointer;
  white-space:nowrap;
}
/* REMOVE AS SETAS DOS CAMPOS type="number" */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}


/* TOGGLE */
.toggle{
  display:flex;
  border-radius:18px;
  border:1px solid var(--border);
  overflow:hidden;
  background:rgba(15,23,42,.7);
}
.toggle button{
  flex:1;
  padding:12px 16px;
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
}
.toggle .active.receita{background:rgba(34,197,94,.2);color:var(--green)}
.toggle .active.despesa{background:rgba(239,68,68,.2);color:var(--red)}
.toggle .active.patrimonio{background:rgba(250,204,21,.2);color:var(--yellow)}

/* GR√ÅFICO PRINCIPAL */
.chart{
  height:340px;
  padding:20px;
  border-radius:26px;
  border:1px solid var(--border);
  background:rgba(15,23,42,.7);
  margin-bottom:28px;
}

/* TR√äS GR√ÅFICOS COLUNA */
.charts-row{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
  margin-bottom:28px;
}
.charts-row .box{
  padding:16px;
  border-radius:22px;
  border:1px solid var(--border);
  background:rgba(15,23,42,.7);
  min-height:320px;
}
.charts-row canvas{width:100% !important; height:260px !important;}

/* LISTAS */
  
/* LISTAS */
.records{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
}
.records .box{
  padding:16px;
  border-radius:22px;
  border:1px solid var(--border);
  background:rgba(15,23,42,.7);
}
.records ul{
  list-style:none;
  max-height:260px;
  overflow-y:auto;
  padding:8px 8px 8px 10px; /* abre espa√ßo para a barra */
}
.records li{
  background:rgba(2,6,23,.6);
  padding:12px 14px;
  border-radius:14px;
  margin-bottom:10px;
  font-size:15px;
  line-height:1.55;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

/* BOT√ïES EDITAR / EXCLUIR */
.btn-group{display:flex;gap:8px}
.btn-edit,.btn-del{
  border:none;
  padding:8px 12px;
  border-radius:14px;
  font-size:12px;
  cursor:pointer;
}
.btn-edit{
  background:rgba(56,189,248,.15);
  color:var(--blue);
  border:1px solid var(--blue);
}
.btn-del{
  background:rgba(239,68,68,.15);
  color:var(--red);
  border:1px solid var(--red);
}

/* MODAIS */
.modal{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(8px);
  animation:fadeIn .15s ease forwards;
}

@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}

.modal.active{display:flex}

/* ====== MODAL EXPORT (vers√£o moderna e alinhada) ====== */
.modal-content{
  background: linear-gradient(
    180deg,
    rgba(56,189,248,.05),
    rgba(15,23,42,.95)
  );
  backdrop-filter: blur(10px);
  border:1px solid rgba(56,189,248,.18);
  border-radius:28px;
  padding:28px 32px;
  width:360px;
  box-shadow:0 0 12px rgba(56,189,248,.10);
  text-align:left;
}


/* T√≠tulo mais profissional */
#modalExport h3{
  font-size:20px;
  color:var(--blue);
  margin-bottom:6px;
}

/* Texto explicativo */
#modalExport p{
  color:var(--muted);
  margin-bottom:14px;
}

/* Checkboxes alinhados */
#modalExport button{
  margin-top:8px;
}

#modalExport button:first-of-type{
  background:linear-gradient(135deg,#2563eb,#38bdf8);
}

#modalExport button:last-of-type{
  background:rgba(239,68,68,.12);
  color:var(--red);
  border:1px solid rgba(239,68,68,.25);
}


/* BOT√ÉO PRINCIPAL */
#modalExport button:first-of-type{
  background:linear-gradient(135deg,#2563eb,#38bdf8);
  border-radius:16px;
  margin-top:12px;
}

/* BOT√ÉO CANCELAR */
#modalExport button:last-of-type{
  background:rgba(239,68,68,.12);
  color:var(--red);
  border:1px solid rgba(239,68,68,.25);
}

/* ====== DEIXA O MODAL DE EXPORTAR ALINHADO E BONITO ====== */
#modalExport .modal-content{
  width: 360px;
  text-align: left;
}

/* D√° espa√ßo interno agrad√°vel */
#modalExport p{
  margin-bottom: 14px;
}

/* Alinhamento perfeito checkbox + texto */
.export-option{
  display:grid;
  grid-template-columns: 20px 1fr;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
  font-size:14px;
  color:var(--text);
  cursor:pointer;
}

.export-option input{
  margin:0;
}

@keyframes slideUp{
  from{transform:translateY(14px)}
  to{transform:translateY(0)}
}

.modal-content h3{
  font-size:20px;
  margin-bottom:10px;
  color:var(--text);
}

.modal-content p{
  color:var(--muted);
  margin-bottom:16px;
}

.modal-content input{
  width:100%;
  padding:12px 14px;
  border-radius:16px;
  background:rgba(2,6,23,.7);
  border:1px solid var(--border);
  color:#fff;
  margin-bottom:10px;
  font-size:14px;
}

.modal-content button{
  width:100%;
  padding:12px 14px;
  border-radius:16px;
  border:none;
  font-weight:600;
  cursor:pointer;
  margin-top:8px;
  transition:.15s ease;
}

.modal-content button:first-of-type{
  background:linear-gradient(135deg,#2563eb,#38bdf8);
  color:#fff;
}

.modal-content button:last-of-type{
  background:rgba(239,68,68,.12);
  color:var(--red);
  border:1px solid rgba(239,68,68,.25);
}

  /* ===== FUNDO AZUL PADR√ÉO PARA OS MODAIS DE EDITAR E EXCLUIR ===== */
#modalEdit .modal-content,
#modalDelete .modal-content{
  background: linear-gradient(
    180deg,
    rgba(56,189,248,.06),
    rgba(15,23,42,.95)
  );
  backdrop-filter: blur(10px);
  border: 1px solid rgba(56,189,248,.18);
  border-radius: 28px;
  box-shadow: 0 0 20px rgba(56,189,248,.15);
}


/* TOAST */
#toast{
  position:fixed;
  bottom:24px;
  right:24px;
  background:rgba(15,23,42,.95);
  border:1px solid var(--border);
  color:white;
  padding:14px 18px;
  border-radius:18px;
  transform:translateY(120%);
  transition:.25s;
}
#toast.active{transform:translateY(0)}
#toast.success{border-left:4px solid var(--green)}
#toast.error{border-left:4px solid var(--red)}

/* CLIENTES */
#clientes{display:none}
.clientes-container{
  max-width:600px;
  background:rgba(15,23,42,.7);
  border:1px solid var(--border);
  border-radius:26px;
  padding:24px;
}
.clientes-container input,
.clientes-container button{
  width:100%;
  padding:14px;
  border-radius:18px;
  margin-bottom:12px;
}

/* === REMOVER SETAS DA BARRA DE ROLAGEM (GARANTIDO) === */
::-webkit-scrollbar-button:single-button {
  display: none !important;
}

/* ===== PADR√ÉO DE SCROLLBAR IGUAL AO INDEX ===== */

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(2,6,23,.8);
}

::-webkit-scrollbar-thumb {
  background: rgba(56,189,248,.3);
  border-radius: 20px;
  border: 2px solid rgba(2,6,23,.8);
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(56,189,248,.5);
}
  
  /* ========== SININHO E PAINEL DE NOTIFICA√á√ïES ========== */

.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.acoes-topo{
  display:flex;
  align-items:center;
  gap:12px;
}

.btn-exportar{
  padding:10px 16px;
  border-radius:14px;
  border:1px solid var(--blue);
  background:rgba(56,189,248,.12);
  color:var(--blue);
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}

.btn-exportar:hover{
  background:rgba(56,189,248,.22);
}

.notificacao-area{
  position:relative;
  font-size:22px;
  cursor:pointer;
  padding:10px;
}

/* bolinha vermelha */
#notifBadge{
  position:absolute;
  top:4px;
  right:2px;
  background:red;
  color:white;
  font-size:12px;
  border-radius:50%;
  padding:2px 6px;
}

/* painel lateral */
#painelNotificacoes{
  position:fixed;
  top:90px;
  right:40px;
  width:320px;
  background:rgba(15,23,42,.95);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px 8px 16px 16px;
  display:none;
  max-height:400px;
  overflow-y:auto;
  box-shadow:0 8px 30px rgba(0,0,0,.4);
  z-index:9999;
  
  scrollbar-width: thin;
  scrollbar-color: rgba(56,189,248,.4) rgba(2,6,23,.8);
}


#painelNotificacoes h3{
  margin-bottom:10px;
  color:var(--text);
}

#painelNotificacoes li{
  background:rgba(2,6,23,.6);
  padding:10px;
  border-radius:12px;
  margin-bottom:8px;
  font-size:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.btn-notif-del{
  background:rgba(239,68,68,.2);
  color:var(--red);
  border:1px solid var(--red);
  border-radius:10px;
  padding:4px 8px;
  font-size:12px;
  cursor:pointer;
  margin-left:10px;
}

#painelNotificacoes li{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

/* FIX DEFINITIVO: alinhamento perfeito dos checkboxes do modal exportar */
.export-option input[type="checkbox"]{
  width:16px;
  height:16px;
  min-width:16px;
  cursor:pointer;
}

</style>
</head>

<body>

<aside class="sidebar">
  <div class="logo">Finance<span style="color:#fff">Pro</span></div>
  <nav class="menu">
    <ul>
      <li class="active"><a onclick="mostrarAba('dashboard',this)">Dashboard</a></li>
      <li><a href="clientes.html">Clientes</a></li>
      <li><a href="controleads.html">Controle Ads</a></li>
    </ul>
  </nav>
</aside>

<main class="content">

<div id="dashboard">

<div class="top-bar">
  <div class="header">Dashboard Financeiro</div>

  <div class="acoes-topo">
    <button class="btn-exportar" onclick="abrirModalExport()">Exportar</button>

    <div class="notificacao-area" onclick="toggleNotificacoes()">
      üîî
      <span id="notifBadge">0</span>
    </div>
  </div>
</div>


<section class="cards">
    <div class="card blue"><span>Receita Total</span><h2 id="cardReceita">R$ 0</h2></div>
    <div class="card red"><span>Despesas Totais</span><h2 id="cardDespesa">R$ 0</h2></div>
    <div class="card yellow"><span>Patrim√¥nio</span><h2 id="cardPatrimonio">R$ 0</h2></div>
    <div class="card green"><span>Saldo</span><h2 id="cardSaldo">R$ 0</h2></div>
  </section>

  <section class="controls">
    <input class="valor-input" type="number" id="valor" placeholder="Valor (R$)">
    <input class="data-input" type="text" id="mes" placeholder="dd/mm/aaaa">
    <input class="desc-input" type="text" id="descricao" placeholder="Descri√ß√£o do lan√ßamento">
    <button onclick="adicionarLancamento()">Adicionar lan√ßamento</button>

    <div class="toggle">
      <button class="active receita" onclick="setTipo('receita',this)">Receita</button>
      <button class="despesa" onclick="setTipo('despesa',this)">Despesa</button>
      <button class="patrimonio" onclick="setTipo('patrimonio',this)">Patrim√¥nio</button>
    </div>
  </section>

  <div class="chart"><canvas id="financeChart"></canvas></div>

  <div class="charts-row">
    <div class="box"><h3>Receitas por descri√ß√£o</h3><canvas id="chartReceita"></canvas></div>
    <div class="box"><h3>Despesas por descri√ß√£o</h3><canvas id="chartDespesa"></canvas></div>
    <div class="box"><h3>Patrim√¥nio por descri√ß√£o</h3><canvas id="chartPatrimonio"></canvas></div>
  </div>

  <section class="records">
    <div class="box"><h3>Receitas</h3><ul id="listaReceita"></ul></div>
    <div class="box"><h3>Despesas</h3><ul id="listaDespesa"></ul></div>
    <div class="box"><h3>Patrim√¥nio</h3><ul id="listaPatrimonio"></ul></div>
  </section>
</div>
  
</main>

<div id="painelNotificacoes">
  <h3>Notifica√ß√µes</h3>
  <ul id="listaNotificacoes"></ul>
</div>


<!-- MODAIS -->
<div class="modal" id="modalExport">
  <div class="modal-content">
    <h3>Exportar Relat√≥rio</h3>
    <p>Escolha o que deseja incluir:</p>

    <label class="export-option">
      <input type="checkbox" id="expReceitas" checked>
      <span>Receitas</span>
    </label>

    <label class="export-option">
      <input type="checkbox" id="expDespesas" checked>
      <span>Despesas</span>
    </label>

    <label class="export-option">
      <input type="checkbox" id="expPatrimonio" checked>
      <span>Patrim√¥nio</span>
    </label>

    <button onclick="gerarRelatorioVisual()">Gerar Relat√≥rio</button>
    <button onclick="fecharModal('modalExport')">Cancelar</button>
  </div>
</div>
  
<!-- ===== MODAL EDITAR ===== -->
<div class="modal" id="modalEdit">
  <div class="modal-content">
    <h3>Editar lan√ßamento</h3>

    <input id="editValor" type="number" placeholder="Valor (R$)">
    <input id="editMes" type="text" placeholder="dd/mm/aaaa">
    <input id="editDesc" type="text" placeholder="Descri√ß√£o">

    <button onclick="salvarEdicao()">Salvar altera√ß√µes</button>
    <button onclick="fecharModal('modalEdit')">Cancelar</button>
  </div>
</div>

<!-- ===== MODAL CONFIRMAR EXCLUS√ÉO ===== -->
<div class="modal" id="modalDelete">
  <div class="modal-content">
    <h3>Confirmar exclus√£o</h3>
    <p>Tem certeza que deseja excluir este lan√ßamento?</p>

    <button onclick="confirmarExclusao()">Sim, excluir</button>
    <button onclick="fecharModal('modalDelete')">Cancelar</button>
  </div>
</div>


<div id="toast"></div>

<script>

if (!localStorage.getItem("logado")) {
  window.location.href = "login.html";
}

if(localStorage.getItem("logado") !== "true"){
  window.location.href = "login.html";
}
const meses=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
let tipoSelecionado='receita';
let financeiro=JSON.parse(localStorage.getItem('financeiro'))||[];
let clientes=JSON.parse(localStorage.getItem('clientes'))||[];
let editandoId=null;
let deletandoId=null;
let notificacoes = JSON.parse(localStorage.getItem('notificacoes')) || [];

  // REFER√äNCIAS DO DOM (ESSENCIAL PARA EDITAR/EXCLUIR FUNCIONAR)
const listaReceita = document.getElementById("listaReceita");
const listaDespesa = document.getElementById("listaDespesa");
const listaPatrimonio = document.getElementById("listaPatrimonio");

const cardReceita = document.getElementById("cardReceita");
const cardDespesa = document.getElementById("cardDespesa");
const cardPatrimonio = document.getElementById("cardPatrimonio");
const cardSaldo = document.getElementById("cardSaldo");


 function registrarNotificacao(texto){
  const novaNotificacao = {
    id: Date.now(),
    texto: texto,
    data: new Date().toISOString()
  };

  notificacoes.push(novaNotificacao);

  // remove notifica√ß√µes com mais de 3 dias
  const agora = new Date();
  notificacoes = notificacoes.filter(n => {
    const dataN = new Date(n.data);
    const diff = (agora - dataN) / (1000 * 60 * 60 * 24);
    return diff <= 3;
  });

  localStorage.setItem('notificacoes', JSON.stringify(notificacoes));
  atualizarPainelNotificacoes();
}

function atualizarPainelNotificacoes(){
  const lista = document.getElementById('listaNotificacoes');
  const badge = document.getElementById('notifBadge');

  lista.innerHTML = '';

  notificacoes.forEach(n => {
    const li = document.createElement('li');
    const data = new Date(n.data).toLocaleString('pt-BR');

    li.innerHTML = `
      <div>
        <strong>${data}</strong><br>
        ${n.texto}
      </div>
      <button class="btn-notif-del" onclick="excluirNotificacao(${n.id})">‚úñ</button>
    `;

    lista.appendChild(li);
  });

  badge.textContent = notificacoes.length;
}

function excluirNotificacao(id){
  notificacoes = notificacoes.filter(n => n.id !== id);
  localStorage.setItem('notificacoes', JSON.stringify(notificacoes));
  atualizarPainelNotificacoes();
}

function mostrarAba(id,el){
  document.querySelectorAll('main>div').forEach(d=>d.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.menu li').forEach(li=>li.classList.remove('active'));
  el.parentElement.classList.add('active');
}

function setTipo(tipo,el){
  tipoSelecionado=tipo;
  document.querySelectorAll('.toggle button').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

function formatar(v){
  return Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
}

function showToast(msg,type){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className=type+' active';
  setTimeout(()=>t.classList.remove('active'),3000);
}

/* Gr√°fico principal */
const chart=new Chart(document.getElementById('financeChart'),{
  type:'line',
  data:{labels:meses,datasets:[
    {label:'Receita',data:Array(12).fill(0),borderColor:'#22c55e'},
    {label:'Despesa',data:Array(12).fill(0),borderColor:'#ef4444'},
    {label:'Patrim√¥nio',data:Array(12).fill(0),borderColor:'#facc15'},
    {label:'Saldo',data:Array(12).fill(0),borderColor:'#38bdf8'}
  ]},
  options:{responsive:true,maintainAspectRatio:false}
});

/* Gr√°ficos de colunas por descri√ß√£o */
const chartReceita=new Chart(document.getElementById('chartReceita'),{
  type:'bar',
  data:{labels:[],datasets:[{data:[],backgroundColor:'#22c55e',borderRadius:8}]},
  options:{responsive:true,maintainAspectRatio:false}
});

const chartDespesa=new Chart(document.getElementById('chartDespesa'),{
  type:'bar',
  data:{labels:[],datasets:[{data:[],backgroundColor:'#ef4444',borderRadius:8}]},
  options:{responsive:true,maintainAspectRatio:false}
});

const chartPatrimonio=new Chart(document.getElementById('chartPatrimonio'),{
  type:'bar',
  data:{labels:[],datasets:[{data:[],backgroundColor:'#facc15',borderRadius:8}]},
  options:{responsive:true,maintainAspectRatio:false}
});

function adicionarLancamento(){
  const valor=Number(document.getElementById('valor').value);
  const mes=document.getElementById('mes').value;
  const descricao=document.getElementById('descricao').value.trim();

  if(!valor||!mes||!descricao){
    showToast('Preencha valor, data e descri√ß√£o','error');
    return;
  }

  financeiro.push({id:Date.now(),valor,tipo:tipoSelecionado,mes,descricao});
  localStorage.setItem('financeiro',JSON.stringify(financeiro));
  showToast('Lan√ßamento adicionado','success');
  registrarNotificacao(`Novo lan√ßamento de ${formatar(valor)} foi adicionado.`);
  atualizarFinanceiro();
}

function animarNumero(elemento, valorFinal, duracao = 800){
  const inicio = 0;
  const passos = 60;
  const intervalo = duracao / passos;
  let contador = 0;

  const timer = setInterval(() => {
    contador++;

    const valorAtual = inicio + (valorFinal * (contador / passos));

    elemento.textContent = Number(valorAtual.toFixed(2))
      .toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    if(contador >= passos){
      clearInterval(timer);
      elemento.textContent = Number(valorFinal)
        .toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    }
  }, intervalo);
}

function atualizarFinanceiro(){
  let r=Array(12).fill(0), d=Array(12).fill(0), p=Array(12).fill(0);
  let mapR={}, mapD={}, mapP={};

  listaReceita.innerHTML='';
  listaDespesa.innerHTML='';
  listaPatrimonio.innerHTML='';

  financeiro.forEach(i=>{
    const partes=i.mes.split('/');
    const idx=new Date(partes[2],partes[1]-1).getMonth();

    if(i.tipo==='receita') r[idx]+=i.valor;
    if(i.tipo==='despesa') d[idx]+=i.valor;
    if(i.tipo==='patrimonio') p[idx]+=i.valor;

    if(i.tipo==='receita') mapR[i.descricao]=(mapR[i.descricao]||0)+i.valor;
    if(i.tipo==='despesa') mapD[i.descricao]=(mapD[i.descricao]||0)+i.valor;
    if(i.tipo==='patrimonio') mapP[i.descricao]=(mapP[i.descricao]||0)+i.valor;

    const li=document.createElement('li');
    li.innerHTML=`
      <div>
        ${formatar(i.valor)} ‚Äî ${i.mes}
        <div class="desc">${i.descricao}</div>
      </div>
      <div class="btn-group">
        <button class="btn-edit" onclick="abrirEditar(${i.id})">Editar</button>
        <button class="btn-del" onclick="pedirExcluir(${i.id})">Excluir</button>
      </div>
    `;

    if(i.tipo==='receita') listaReceita.appendChild(li);
    if(i.tipo==='despesa') listaDespesa.appendChild(li);
    if(i.tipo==='patrimonio') listaPatrimonio.appendChild(li);
  });

  const totalR=r.reduce((a,b)=>a+b,0);
  const totalD=d.reduce((a,b)=>a+b,0);
  const totalP=p.reduce((a,b)=>a+b,0);

  animarNumero(cardReceita, totalR);
  animarNumero(cardDespesa, totalD);
  animarNumero(cardPatrimonio, totalP);
  animarNumero(cardSaldo, totalR - totalD + totalP);


  chart.data.datasets[0].data=r;
  chart.data.datasets[1].data=d;
  chart.data.datasets[2].data=p;
  chart.data.datasets[3].data=r.map((v,i)=>v-d[i]+p[i]);
  chart.update();

  chartReceita.data.labels=Object.keys(mapR);
  chartReceita.data.datasets[0].data=Object.values(mapR);
  chartReceita.update();

  chartDespesa.data.labels=Object.keys(mapD);
  chartDespesa.data.datasets[0].data=Object.values(mapD);
  chartDespesa.update();

  chartPatrimonio.data.labels=Object.keys(mapP);
  chartPatrimonio.data.datasets[0].data=Object.values(mapP);
  chartPatrimonio.update();
}

/* EDI√á√ÉO */
function abrirEditar(id){
  editandoId=id;
  const it=financeiro.find(f=>f.id===id);
  editValor.value=it.valor;
  editMes.value=it.mes;
  editDesc.value=it.descricao;
  document.getElementById('modalEdit').classList.add('active');
}

function salvarEdicao(){
  const idx=financeiro.findIndex(f=>f.id===editandoId);
  financeiro[idx].valor=Number(editValor.value);
  financeiro[idx].mes=editMes.value;
  financeiro[idx].descricao=editDesc.value;
  localStorage.setItem('financeiro',JSON.stringify(financeiro));
  fecharModal('modalEdit');
  showToast('Altera√ß√µes salvas','success');
  registrarNotificacao(`Um lan√ßamento foi editado para ${formatar(financeiro[idx].valor)}.`);
  atualizarFinanceiro();
}

/* EXCLUS√ÉO */
function pedirExcluir(id){
  deletandoId=id;
  document.getElementById('modalDelete').classList.add('active');
}

function confirmarExclusao(){
  financeiro=financeiro.filter(f=>f.id!==deletandoId);
  localStorage.setItem('financeiro',JSON.stringify(financeiro));
  fecharModal('modalDelete');
  showToast('Item exclu√≠do','success');
  registrarNotificacao('Um lan√ßamento foi exclu√≠do.');
  atualizarFinanceiro();
}

function fecharModal(id){
  document.getElementById(id).classList.remove('active');
}

/* CLIENTES */
function adicionarCliente(){
  const nome=clienteNome.value;
  const val=Number(clienteValor.value);

  if(!nome||!val){
    showToast('Nome e valor s√£o obrigat√≥rios','error');
    return;
  }

  clientes.push({id:Date.now(),nome,val});
  localStorage.setItem('clientes',JSON.stringify(clientes));
}

function atualizarClientes(){
  listaClientes.innerHTML='';
  clientes.forEach(c=>{
    const li=document.createElement('li');
    li.textContent=`${c.nome} ‚Äî ${formatar(c.val)}`;
    listaClientes.appendChild(li);
  });
}

function toggleNotificacoes(){
  const painel = document.getElementById('painelNotificacoes');
  painel.style.display = painel.style.display === 'block' ? 'none' : 'block';
}

 window.addEventListener('scroll', function(){
  const painel = document.getElementById('painelNotificacoes');
  painel.style.display = 'none';
});

function abrirModalExport(){
  document.getElementById('modalExport').classList.add('active');
}

function gerarRelatorioVisual(){
  const incluirReceitas = document.getElementById('expReceitas').checked;
  const incluirDespesas = document.getElementById('expDespesas').checked;
  const incluirPatrimonio = document.getElementById('expPatrimonio').checked;

  const totalReceitas = financeiro
    .filter(f => f.tipo === 'receita')
    .reduce((s, i) => s + i.valor, 0);

  const totalDespesas = financeiro
    .filter(f => f.tipo === 'despesa')
    .reduce((s, i) => s + i.valor, 0);

  const totalPatrimonio = financeiro
    .filter(f => f.tipo === 'patrimonio')
    .reduce((s, i) => s + i.valor, 0);

  const saldoFinal = totalReceitas - totalDespesas + totalPatrimonio;

  const janela = window.open("", "_blank");

  let html = `
  <html>
  <head>
    <title>Relat√≥rio Financeiro</title>
    <style>
      body{
        font-family: system-ui, -apple-system, Arial;
        background:#020617;
        color:#e5e7eb;
        padding:40px;
      }
      h1{color:#38bdf8;}

.report-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:30px;
}

.report-header h1{
  margin:0;
}

      .secao{
        background:rgba(15,23,42,.7);
        border:1px solid #1e293b;
        border-radius:20px;
        padding:20px;
        margin-bottom:20px;
      }

      .item{
        padding:10px 0;
        border-bottom:1px solid #1e293b;
      }

      .btn-pdf{
        margin:20px 0;
        padding:12px 20px;
        border-radius:14px;
        border:none;
        background:#38bdf8;
        color:#020617;
        font-weight:700;
        cursor:pointer;
      }

      @media print {
        .btn-pdf {
          display: none;
        }
        body {
          padding: 20px;
        }
      }
    </style>
  </head>

  <body>
<div class="report-header">
  <h1>Relat√≥rio Financeiro</h1>

  <button class="btn-pdf" onclick="window.print()">Baixar PDF</button>
</div>

  `;

  if(incluirReceitas){
    html += `<div class="secao"><h2>Receitas</h2>`;
    financeiro.filter(f=>f.tipo==='receita').forEach(i=>{
      html += `
        <div class="item">
          <strong>${formatar(i.valor)}</strong> ‚Äî ${i.mes}<br>
          ${i.descricao}
        </div>
      `;
    });
    html += `</div>`;
  }

  if(incluirDespesas){
    html += `<div class="secao"><h2>Despesas</h2>`;
    financeiro.filter(f=>f.tipo==='despesa').forEach(i=>{
      html += `
        <div class="item">
          <strong>${formatar(i.valor)}</strong> ‚Äî ${i.mes}<br>
          ${i.descricao}
        </div>
      `;
    });
    html += `</div>`;
  }

  if(incluirPatrimonio){
    html += `<div class="secao"><h2>Patrim√¥nio</h2>`;
    financeiro.filter(f=>f.tipo==='patrimonio').forEach(i=>{
      html += `
        <div class="item">
          <strong>${formatar(i.valor)}</strong> ‚Äî ${i.mes}<br>
          ${i.descricao}
        </div>
      `;
    });
    html += `</div>`;
  }

  html += `
    <div class="secao">
      <h2>Conclus√£o ‚Äî Saldo Final</h2>
      <div class="item">
        <strong>${formatar(saldoFinal)}</strong><br>
        Valor total dispon√≠vel ap√≥s receitas, despesas e patrim√¥nio
      </div>
    </div>
  `;

  html += `
  </body>
  </html>
  `;

  janela.document.write(html);
  janela.document.close();
  fecharModal('modalExport');
}


// Inicializa√ß√£o do sistema
mostrarAba('dashboard',document.querySelector('.menu a'));
atualizarFinanceiro();
atualizarClientes();
atualizarPainelNotificacoes();

</script>

</body>
